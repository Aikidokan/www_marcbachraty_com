##powershell, add security to web

$Websitefolder="C:\Code\www_marcbachraty_com\root";$GrantAccessTo="IIS_IUSRS"; Get-ChildItem -path $Websitefolder | Where { $_.name -eq "App_Code" -or $_.name -eq "App_Data" -or $_.name -eq "Bin" -or $_.name -eq "Config" -or $_.name -eq "Css" -or $_.name -eq "MacroScripts" -or $_.name -eq "Masterpages" -or $_.name -eq "Media" -or $_.name -eq "Scripts" -or $_.name -eq "Umbraco" -or $_.name -eq "Umbraco_client" -or $_.name -eq "UserControls" -or $_.name -eq "Views" -or $_.name -eq "Xslt" -or $_.name -eq "web.config" } | ForEach {$Path = $_.Fullname; $Permission= "Modify"; $GetACL = Get-Acl $Path; if ($_.PSIsContainer){; Write-Host "Is folder, setting InheritanceFlags: $Path" -ForegroundColor Cyan      ; $Allinherit = [system.security.accesscontrol.InheritanceFlags]"ContainerInherit, ObjectInherit"; $Allpropagation = [system.security.accesscontrol.PropagationFlags]"None"; $AccessRule = New-Object system.security.AccessControl.FileSystemAccessRule($GrantAccessTo, $Permission, $AllInherit, $Allpropagation, "Allow"); }else{; $AccessRule = New-Object system.security.AccessControl.FileSystemAccessRule($GrantAccessTo, $Permission, "Allow"); }; if ($GetACL.Access | Where { $_.IdentityReference -eq $GrantAccessTo}) {; Write-Host "Modifying Permissions For: $GrantAccessTo On:$Path" -ForegroundColor Yellow; $AccessModification = New-Object system.security.AccessControl.AccessControlModification; $AccessModification.value__ = 2; $Modification = $False; $GetACL.ModifyAccessRule($AccessModification, $AccessRule, [ref]$Modification) | Out-Null; } else {; Write-Host "Adding Permission: $Permission For: $GrantAccessTo On: $Path"; $GetACL.AddAccessRule($AccessRule); }; Set-Acl -aclobject $GetACL -Path $Path; Write-Host "Permission: $Permission Set For: $GrantAccessTo" -ForegroundColor Green; }